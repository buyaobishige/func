(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{303:function(t,s,a){t.exports=a.p+"assets/img/db_v2.acd34e13.png"},326:function(t,s,a){"use strict";a.r(s);var _=a(12),n=Object(_.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"数据库文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库文档"}},[t._v("#")]),t._v(" 数据库文档")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("小贴士")]),t._v(" "),s("p",[t._v("目前已可局域网访问。暂时无法在公网访问。")])]),t._v(" "),s("h2",{attrs:{id:"一、数据库结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、数据库结构"}},[t._v("#")]),t._v(" 一、数据库结构")]),t._v(" "),s("p",[s("img",{attrs:{src:a(303),alt:"总数据"}})]),t._v(" "),s("ul",[s("li",[t._v("原始数据：存放艺术，奖励，专著，专利等底层数据，与elasticsearch中的数据相同。")]),t._v(" "),s("li",[t._v("工单、新闻、咨询：管理用户工单、咨询申请和新闻信息，实现客户问题的跟踪处理和资讯发布功能。")]),t._v(" "),s("li",[t._v("胜者排名：本模块主要用于存放胜者排名，分为国际和国内，分析全球高校间的论文互引关系。")]),t._v(" "),s("li",[t._v("核心功能：主要用户沙盘推演，以及当前名次解析等")]),t._v(" "),s("li",[t._v("用户-学校-权限：主要用于用户认证、权限控制和学校基本数据存储。")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("各表中long_id的编写规范")]),t._v(" "),s("p",[t._v("对于已有唯一号的，均予以保留。")]),t._v(" "),s("p",[t._v("未统一编号的，所使用的long_id形如B24111903002492。")]),t._v(" "),s("ul",[s("li",[t._v("第1位B（公办）本科/M民办本科/Z高职高专与职业大学，区分公办民办本科和职专（B有时会指公办民办本科，M不单列）。")]),t._v(" "),s("li",[t._v("2-7位填上传日期。")]),t._v(" "),s("li",[t._v("8-9位填上传时的领域，例如有10种不同竞赛，那么这两位可以依次填01-10，只要与本地文件保持一直即可。")]),t._v(" "),s("li",[t._v("10-15位填递增序号。")])])]),t._v(" "),s("h2",{attrs:{id:"二、分模块介绍表结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、分模块介绍表结构"}},[t._v("#")]),t._v(" 二、分模块介绍表结构")]),t._v(" "),s("h3",{attrs:{id:"用户-学校-权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户-学校-权限"}},[t._v("#")]),t._v(" 用户-学校-权限")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("表间联系")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("users")]),t._v("通过"),s("code",[t._v("groups_id")]),t._v("关联"),s("code",[t._v("user_group")])]),t._v(" "),s("li",[s("code",[t._v("user_group_permissions")]),t._v("作为中间表连接"),s("code",[t._v("user_group")]),t._v("和"),s("code",[t._v("user_permission")])]),t._v(" "),s("li",[s("code",[t._v("school_mapping")]),t._v("和"),s("code",[t._v("school_data")]),t._v("通过"),s("code",[t._v("school_data_id")]),t._v("和"),s("code",[t._v("school_mapping_id")]),t._v("相互关联")]),t._v(" "),s("li",[t._v("通过"),s("code",[t._v("school_mapping")]),t._v("设置学校层面的权限和对比校")])])]),t._v(" "),s("h4",{attrs:{id:"表结构说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表结构说明"}},[t._v("#")]),t._v(" 表结构说明")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("users (用户表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增主键")]),t._v(" "),s("li",[s("code",[t._v("user_id")]),t._v(": cookie记录的用户ID")]),t._v(" "),s("li",[s("code",[t._v("username")]),t._v(": 登录用户名(唯一)")]),t._v(" "),s("li",[s("code",[t._v("password")]),t._v(": SHA256哈希密码")]),t._v(" "),s("li",[s("code",[t._v("sch_code")]),t._v(": 关联学校编码")]),t._v(" "),s("li",[s("code",[t._v("created_at")]),t._v(": 创建时间")]),t._v(" "),s("li",[s("code",[t._v("last_login")]),t._v(": 最后登录时间")]),t._v(" "),s("li",[s("code",[t._v("email")]),t._v(": 邮箱")]),t._v(" "),s("li",[s("code",[t._v("login_attempts")]),t._v(": 连续登录失败次数")]),t._v(" "),s("li",[s("code",[t._v("account_locked_until")]),t._v(": 账户锁定截止时间")]),t._v(" "),s("li",[s("code",[t._v("last_failed_attempt")]),t._v(": 最后失败登录时间")]),t._v(" "),s("li",[s("code",[t._v("salt")]),t._v(": 静态salt")]),t._v(" "),s("li",[s("code",[t._v("is_active")]),t._v(": 是否激活")]),t._v(" "),s("li",[s("code",[t._v("is_anonymous")]),t._v(": 是否匿名用户(废弃)")]),t._v(" "),s("li",[s("code",[t._v("is_authenticated")]),t._v(": 是否认证")]),t._v(" "),s("li",[s("code",[t._v("is_superuser")]),t._v(": 是否为超级用户")]),t._v(" "),s("li",[s("code",[t._v("is_staff")]),t._v(": 是否为管理员")]),t._v(" "),s("li",[s("code",[t._v("groups_id")]),t._v(": 权限组ID")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("user_permission (权限表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("api_url")]),t._v(": API接口URL")]),t._v(" "),s("li",[s("code",[t._v("parameter")]),t._v(": 参数名称")]),t._v(" "),s("li",[s("code",[t._v("data")]),t._v(": 参数值")]),t._v(" "),s("li",[s("code",[t._v("method")]),t._v(": 发送方式")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("user_group_permissions (权限组-权限中间表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("usergroup_id")]),t._v(": 权限组ID")]),t._v(" "),s("li",[s("code",[t._v("userpermission_id")]),t._v(": 权限ID")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("user_group (用户权限组表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("permission_group_name")]),t._v(": 权限组名称")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("school_mapping (学校权限表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("sch_code")]),t._v(": 学科code")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("compare_sch_name")]),t._v(": 对比校")]),t._v(" "),s("li",[s("code",[t._v("school_data_id")]),t._v(": 学校信息ID")]),t._v(" "),s("li",[s("code",[t._v("can_view_all_compare")]),t._v(": 是否可查看所有对比学校")]),t._v(" "),s("li",[s("code",[t._v("can_search_full")]),t._v(": 是否有全库查找权限")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("school_data (学校基本信息表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("rank")]),t._v(": 综合实力排名")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("province")]),t._v(": 省份")]),t._v(" "),s("li",[s("code",[t._v("location")]),t._v(": 所在地")]),t._v(" "),s("li",[s("code",[t._v("reference_type")]),t._v(": 学校参考类型")]),t._v(" "),s("li",[s("code",[t._v("broad_categor")]),t._v(": 学校参考类")]),t._v(" "),s("li",[s("code",[t._v("detailed_reference_type")]),t._v(": 学校细分参考型")]),t._v(" "),s("li",[s("code",[t._v("reference_model")]),t._v(": 学校参考型")]),t._v(" "),s("li",[s("code",[t._v("top_university")]),t._v(": 中国一流大学")]),t._v(" "),s("li",[s("code",[t._v("is_double_first_class")]),t._v(": 双一流")]),t._v(" "),s("li",[s("code",[t._v("city")]),t._v(": 城市")]),t._v(" "),s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("school_mapping_id")]),t._v(": 学校权限表ID")]),t._v(" "),s("li",[s("code",[t._v("sch_en_name")]),t._v(": 学校英文名")]),t._v(" "),s("li",[s("code",[t._v("is_985")]),t._v(": 是否为985")]),t._v(" "),s("li",[s("code",[t._v("is_211")]),t._v(": 是否为211")]),t._v(" "),s("li",[s("code",[t._v("main_department")]),t._v(": 主管部门")]),t._v(" "),s("li",[s("code",[t._v("sch_type_detail")]),t._v(": 学校类型")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("django_session (会话表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("session_key")]),t._v(": 会话键")]),t._v(" "),s("li",[s("code",[t._v("session_data")]),t._v(": 会话数据")]),t._v(" "),s("li",[s("code",[t._v("create_date")]),t._v(": 创建时间")]),t._v(" "),s("li",[s("code",[t._v("expire_date")]),t._v(": 失效时间")]),t._v(" "),s("li",[s("code",[t._v("user_id")]),t._v(": 用户ID")]),t._v(" "),s("li",[s("code",[t._v("salt")]),t._v(": 动态salt")])])]),t._v(" "),s("h3",{attrs:{id:"原始数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原始数据"}},[t._v("#")]),t._v(" 原始数据")]),t._v(" "),s("h4",{attrs:{id:"表间联系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表间联系"}},[t._v("#")]),t._v(" 表间联系")]),t._v(" "),s("p",[t._v("所有表通过"),s("code",[t._v("sch_name")]),t._v("(学校名称)字段关联")]),t._v(" "),s("h4",{attrs:{id:"表结构说明-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表结构说明-2"}},[t._v("#")]),t._v(" 表结构说明")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("patent_res (专利表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("long_id")]),t._v(": 唯一号")]),t._v(" "),s("li",[s("code",[t._v("full_name")]),t._v(": 中文题名")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 最终校名")]),t._v(" "),s("li",[s("code",[t._v("unit_number")]),t._v(": 单位总数")]),t._v(" "),s("li",[s("code",[t._v("unit_order")]),t._v(": 单位顺序")]),t._v(" "),s("li",[s("code",[t._v("patent_type")]),t._v(": 专利类型")]),t._v(" "),s("li",[s("code",[t._v("writer")]),t._v(": 发明(设计)人")]),t._v(" "),s("li",[s("code",[t._v("authorization")]),t._v(": 授权")]),t._v(" "),s("li",[s("code",[t._v("transfer")]),t._v(": 转移")]),t._v(" "),s("li",[s("code",[t._v("license")]),t._v(": 许可")]),t._v(" "),s("li",[s("code",[t._v("year")]),t._v(": 授权年份")]),t._v(" "),s("li",[s("code",[t._v("final_score")]),t._v(": 最终得分")]),t._v(" "),s("li",[s("code",[t._v("basic_score")]),t._v(": 基础得分")]),t._v(" "),s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("source_db")]),t._v(": 来源数据库")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("book_res (专著表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("long_id")]),t._v(": 匹配编号")]),t._v(" "),s("li",[s("code",[t._v("book_type")]),t._v(": 库别")]),t._v(" "),s("li",[s("code",[t._v("full_name")]),t._v(": 著作名")]),t._v(" "),s("li",[s("code",[t._v("writer")]),t._v(": 完成人")]),t._v(" "),s("li",[s("code",[t._v("year")]),t._v(": 年份")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 最终校名")]),t._v(" "),s("li",[s("code",[t._v("publisher")]),t._v(": 出版社")]),t._v(" "),s("li",[s("code",[t._v("final_score")]),t._v(": 最终得分")]),t._v(" "),s("li",[s("code",[t._v("basic_score")]),t._v(": 基础得分")]),t._v(" "),s("li",[s("code",[t._v("unit_number")]),t._v(": 完成单位总数")]),t._v(" "),s("li",[s("code",[t._v("unit_order")]),t._v(": 完成单位顺序")]),t._v(" "),s("li",[s("code",[t._v("total_citation_count")]),t._v(": 引用次数")]),t._v(" "),s("li",[s("code",[t._v("source_db")]),t._v(": 数据库来源")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("award_res (奖项表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("long_id")]),t._v(": 匹配编号")]),t._v(" "),s("li",[s("code",[t._v("awardaffiliation")]),t._v(": 奖属")]),t._v(" "),s("li",[s("code",[t._v("full_name")]),t._v(": 项目名称")]),t._v(" "),s("li",[s("code",[t._v("writer")]),t._v(": 完成人")]),t._v(" "),s("li",[s("code",[t._v("year")]),t._v(": 年份")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 最终校名")]),t._v(" "),s("li",[s("code",[t._v("category")]),t._v(": 获奖类别")]),t._v(" "),s("li",[s("code",[t._v("award_level")]),t._v(": 获奖等级")]),t._v(" "),s("li",[s("code",[t._v("final_score")]),t._v(": 最终得分")]),t._v(" "),s("li",[s("code",[t._v("basic_score")]),t._v(": 基础得分")]),t._v(" "),s("li",[s("code",[t._v("unit_number")]),t._v(": 完成单位总数")]),t._v(" "),s("li",[s("code",[t._v("unit_order")]),t._v(": 完成单位顺序")]),t._v(" "),s("li",[s("code",[t._v("org_name")]),t._v(": 学院")]),t._v(" "),s("li",[s("code",[t._v("source_db")]),t._v(": 来源数据库")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("artistic_res (艺术作品表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("long_id")]),t._v(": 唯一ID")]),t._v(" "),s("li",[s("code",[t._v("type")]),t._v(": 获奖类型")]),t._v(" "),s("li",[s("code",[t._v("category")]),t._v(": 获奖来源类别")]),t._v(" "),s("li",[s("code",[t._v("award_level")]),t._v(": 获奖等级")]),t._v(" "),s("li",[s("code",[t._v("full_name")]),t._v(": 项目名称")]),t._v(" "),s("li",[s("code",[t._v("unit_order")]),t._v(": 单位排名")]),t._v(" "),s("li",[s("code",[t._v("unit_number")]),t._v(": 单位总数")]),t._v(" "),s("li",[s("code",[t._v("final_score")]),t._v(": 最终得分")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("source_db")]),t._v(": 来源数据库")]),t._v(" "),s("li",[s("code",[t._v("sch_type")]),t._v(": 学校类型")]),t._v(" "),s("li",[s("code",[t._v("second_kind")]),t._v(": 专业类")]),t._v(" "),s("li",[s("code",[t._v("writer")]),t._v(": 获奖人")]),t._v(" "),s("li",[s("code",[t._v("award_type")]),t._v(": 艺术类型")]),t._v(" "),s("li",[s("code",[t._v("id")]),t._v(": 自增ID")]),t._v(" "),s("li",[s("code",[t._v("year")]),t._v(": 年份")])])]),t._v(" "),s("h3",{attrs:{id:"胜者排名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#胜者排名"}},[t._v("#")]),t._v(" 胜者排名")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("表间联系")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("cite_rank_score_en")]),t._v("和"),s("code",[t._v("cite_rank_score_cn")]),t._v("提供排名得分标准")]),t._v(" "),s("li",[s("code",[t._v("cite_en_rank")]),t._v("和"),s("code",[t._v("cite_cn")]),t._v("分别记录国际和国内高校引用数据")]),t._v(" "),s("li",[s("code",[t._v("cite_all")]),t._v("汇总全球高校对比结果")]),t._v(" "),s("li",[s("code",[t._v("cite_adjust_rank_en")]),t._v("和"),s("code",[t._v("cite_adjust_rank_cn")]),t._v("存储调整后的排名结果")])])]),t._v(" "),s("h4",{attrs:{id:"表结构说明-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表结构说明-3"}},[t._v("#")]),t._v(" 表结构说明")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_rank_score_en (国际胜者排名得分表)")]),t._v(" "),s("p",[s("strong",[t._v("说明")]),t._v("：每个排名对应得多少分")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("rank")]),t._v(": 胜者排名(主键)")]),t._v(" "),s("li",[s("code",[t._v("rank_score")]),t._v(": 胜者排名分")]),t._v(" "),s("li",[s("code",[t._v("cite_score")]),t._v(": 国际论文引用胜者归一得分")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_rank_score_cn (国内胜者排名得分表)")]),t._v(" "),s("p",[s("strong",[t._v("说明")]),t._v("：每个排名对应得多少分")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("rank")]),t._v(": 胜者排名(主键)")]),t._v(" "),s("li",[s("code",[t._v("rank_score")]),t._v(": 胜者排名分")]),t._v(" "),s("li",[s("code",[t._v("cite_score")]),t._v(": 国内论文引用胜者归一得分")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_en_rank (国际高校引用排名表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 大学名称")]),t._v(" "),s("li",[s("code",[t._v("cite_count")]),t._v(": 被引量")]),t._v(" "),s("li",[s("code",[t._v("rank")]),t._v(": 排名")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_cn (国内高校引用对比表)")]),t._v(" "),s("p",[t._v("说明：所有高校之间的论文引用胜者胜负情况")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("compare_sch")]),t._v(": 对比校")]),t._v(" "),s("li",[s("code",[t._v("win")]),t._v(": 是否赢")]),t._v(" "),s("li",[s("code",[t._v("lose")]),t._v(": 是否输")]),t._v(" "),s("li",[s("code",[t._v("draw")]),t._v(": 是否平")]),t._v(" "),s("li",[s("code",[t._v("empty")]),t._v(": 是否无引用")]),t._v(" "),s("li",[s("code",[t._v("cite_scd")]),t._v(": 本校对对比校的scd引用量")]),t._v(" "),s("li",[s("code",[t._v("cite_scdw")]),t._v(": 本校对对比校的scdw引用量")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_all (全球高校引用对比汇总表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("sch_country")]),t._v(": 学校所在国家")]),t._v(" "),s("li",[s("code",[t._v("compare_country")]),t._v(": 对比大洲")]),t._v(" "),s("li",[s("code",[t._v("sch_num")]),t._v(": 学校所在国家的数量")]),t._v(" "),s("li",[s("code",[t._v("win")]),t._v(": 赢了多少学校")]),t._v(" "),s("li",[s("code",[t._v("lose")]),t._v(": 输了多少学校")]),t._v(" "),s("li",[s("code",[t._v("win_rate")]),t._v(": 赢的比例")]),t._v(" "),s("li",[s("code",[t._v("draw")]),t._v(": 平局数")]),t._v(" "),s("li",[s("code",[t._v("empty")]),t._v(": 胜负差值(win-lose)")]),t._v(" "),s("li",[s("code",[t._v("diff")]),t._v(": 无引用情况")]),t._v(" "),s("li",[s("code",[t._v("continent")]),t._v(": 大洲")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_adjust_rank_en (国际调整后排名表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 校名")]),t._v(" "),s("li",[s("code",[t._v("adjust_rate")]),t._v(": 引用量调整比例")]),t._v(" "),s("li",[s("code",[t._v("adjust_rank")]),t._v(": 调整后SCDW胜者排名")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("cite_adjust_rank_cn (国内调整后排名表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 校名")]),t._v(" "),s("li",[s("code",[t._v("adjust_rate")]),t._v(": 引用量调整比例")]),t._v(" "),s("li",[s("code",[t._v("adjust_rank")]),t._v(": 调整后SCD胜者排名")])])]),t._v(" "),s("h3",{attrs:{id:"核心功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心功能"}},[t._v("#")]),t._v(" 核心功能")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("表间联系")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("research_jiangxiang_25")]),t._v("和"),s("code",[t._v("research_25")]),t._v("存储核心科研成果数据")]),t._v(" "),s("li",[s("code",[t._v("raw_data_time_range_25")]),t._v("和"),s("code",[t._v("raw_data_middle_25")]),t._v("提供竞赛数据支持")]),t._v(" "),s("li",[s("code",[t._v("dynamicrank")]),t._v("表整合各类指标生成动态排名")]),t._v(" "),s("li",[s("code",[t._v("group")]),t._v("表管理用户自定义学校分组")])])]),t._v(" "),s("h4",{attrs:{id:"表结构说明-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表结构说明-4"}},[t._v("#")]),t._v(" 表结构说明")]),t._v(" "),s("p",[s("strong",[t._v("特别注意")]),t._v(":计算本科科研得分时，须使用调整过的最终概率作为probability_all_in_one。此处应当跟子谦确认。")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("research_jiangxiang_25 (奖励数据表)")]),t._v(" "),s("p",[s("strong",[t._v("说明")]),t._v("：存放奖项数据")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("long_id")]),t._v(": 唯一ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("date")]),t._v(": 年份")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("basic_score")]),t._v(": 基础分数")]),t._v(" "),s("li",[s("code",[t._v("final_score")]),t._v(": 最终分数")]),t._v(" "),s("li",[s("code",[t._v("probability_all_in_one")]),t._v(": 属于学科类的概率")]),t._v(" "),s("li",[s("code",[t._v("from_db")]),t._v(": 数据库来源")]),t._v(" "),s("li",[s("code",[t._v("type")]),t._v(": 类型")]),t._v(" "),s("li",[s("code",[t._v("sch_type")]),t._v(": 学校类型")]),t._v(" "),s("li",[s("code",[t._v("category")]),t._v(": 奖励类别")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("research_25 (综合科研成果表)")]),t._v(" "),s("p",[s("strong",[t._v("说明")]),t._v("：存放除奖项外，其他如竞赛，论文，专著、艺术，思政、专利等基础数据")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("long_id")]),t._v(": 唯一ID")]),t._v(" "),s("li",[s("code",[t._v("date")]),t._v(": 年份")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("basic_score")]),t._v(": 基础得分")]),t._v(" "),s("li",[s("code",[t._v("final_score")]),t._v(": 最终得分")]),t._v(" "),s("li",[s("code",[t._v("probability_all_in_one")]),t._v(": 属于学科类的概率")]),t._v(" "),s("li",[s("code",[t._v("from_db")]),t._v(": 数据来源")]),t._v(" "),s("li",[s("code",[t._v("type")]),t._v(": 类型")]),t._v(" "),s("li",[s("code",[t._v("sch_type")]),t._v(": 学校类型")])])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("使用research_25表计算本科科研得分时，须使用调整过的最终概率作为probability_all_in_one。此处应当跟子谦确认。")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("raw_data_time_range_25 (本校排名数据库表)")]),t._v(" "),s("p",[t._v("说明：本张表用于网站的本校排名数据模块")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("category")]),t._v(": 类别")]),t._v(" "),s("li",[s("code",[t._v("name")]),t._v(":名称")]),t._v(" "),s("li",[s("code",[t._v("sub_project")]),t._v(": 项目")]),t._v(" "),s("li",[s("code",[t._v("max_date")]),t._v(": 最大时间")]),t._v(" "),s("li",[s("code",[t._v("min_date")]),t._v(": 最小时间")]),t._v(" "),s("li",[s("code",[t._v("update_time")]),t._v(": 更新时间")]),t._v(" "),s("li",[s("code",[t._v("sch_type")]),t._v(": 学校类型")]),t._v(" "),s("li",[s("code",[t._v("sch_type_detail")]),t._v(": 学校类型详情")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("raw_data_middle_25 (本校排名数据库总数表)")]),t._v(" "),s("p",[t._v("说明：本张表用于生成网站的本校排名数据模块的原始数据/总条数即（"),s("code",[t._v("total_SUM")]),t._v("字段），更加方便")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("category")]),t._v(": 类别")]),t._v(" "),s("li",[s("code",[t._v("name")]),t._v(": 名称")]),t._v(" "),s("li",[s("code",[t._v("sub_project")]),t._v(": 项目名称")]),t._v(" "),s("li",[s("code",[t._v("total_SUM")]),t._v(": 获奖总数")]),t._v(" "),s("li",[s("code",[t._v("CURRENT_SUM")]),t._v(": 本次获奖数")]),t._v(" "),s("li",[s("code",[t._v("LAST_SUM")]),t._v(": 上次获奖数")]),t._v(" "),s("li",[s("code",[t._v("update_time")]),t._v(": 更新时间")]),t._v(" "),s("li",[s("code",[t._v("sum_first_order")]),t._v(": 第一获奖单位次数")]),t._v(" "),s("li",[s("code",[t._v("sch_type_detail")]),t._v(": 学校种类")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("jiangxiang_info_25 (奖项详情表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("long_id")]),t._v(": 唯一ID")]),t._v(" "),s("li",[s("code",[t._v("项目名称")]),t._v(": 项目名称")]),t._v(" "),s("li",[s("code",[t._v("获奖等级")]),t._v(": 获奖等级")]),t._v(" "),s("li",[s("code",[t._v("完成单位总数")]),t._v(": 完成单位总数")]),t._v(" "),s("li",[s("code",[t._v("完成单位顺序")]),t._v(": 完成单位顺序")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("group (学校分组表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("school_mapping_id")]),t._v(": 学校权限表ID")]),t._v(" "),s("li",[s("code",[t._v("group_school_id")]),t._v(": 学校组ID")]),t._v(" "),s("li",[s("code",[t._v("selection_order")]),t._v(": 排名")]),t._v(" "),s("li",[s("code",[t._v("user_id")]),t._v(": 用户ID")]),t._v(" "),s("li",[s("code",[t._v("name")]),t._v(": 学校组名称")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("dynamicrank (动态排名表)")]),t._v(" "),s("p",[s("strong",[t._v("说明")]),t._v("：当前名次模块数据均由本表提供")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 校名")]),t._v(" "),s("li",[s("code",[t._v("StrengthRank")]),t._v(": 综合实力排名")]),t._v(" "),s("li",[s("code",[t._v("Strength")]),t._v(": 综合实力得分")]),t._v(" "),s("li",[s("code",[t._v("UndergraduateEmploymentQuality")]),t._v(": 本科生就业质量")]),t._v(" "),s("li",[s("code",[t._v("UndergraduateEmploymentQualityRank")]),t._v(": 本科生就业质量排名")]),t._v(" "),s("li",[s("code",[t._v("ScoreLine")]),t._v(": 录取分数线")]),t._v(" "),s("li",[s("code",[t._v("ScoreLineRank")]),t._v(": 录取分数线排名")]),t._v(" "),s("li",[s("code",[t._v("FacultyAcademicLevel")]),t._v(": 教师学术水平")]),t._v(" "),s("li",[s("code",[t._v("FacultyAcademicLevelRank")]),t._v(": 教师学术水平排名")]),t._v(" "),s("li",[s("code",[t._v("SelectionScore")]),t._v(": 择校顺序得分")]),t._v(" "),s("li",[s("code",[t._v("SelectionScoreRank")]),t._v(": 择校顺序排名")]),t._v(" "),s("li",[s("code",[t._v("PoliticalNormalization")]),t._v(": 党建思政得分")]),t._v(" "),s("li",[s("code",[t._v("PoliticalNormalizationRank")]),t._v(": 党建思政排名")]),t._v(" "),s("li",[s("code",[t._v("AdvancementRate")]),t._v(": 升学率")]),t._v(" "),s("li",[s("code",[t._v("AdvancementRateRank")]),t._v(": 升学率排名")]),t._v(" "),s("li",[s("code",[t._v("CompetitionNormalization")]),t._v(": 学生竞赛得分")]),t._v(" "),s("li",[s("code",[t._v("CompetitionNormalizationRank")]),t._v(": 学生竞赛排名")]),t._v(" "),s("li",[s("code",[t._v("CostEffectivenessNormalization")]),t._v(": 性价比得分")]),t._v(" "),s("li",[s("code",[t._v("CostEffectivenessNormalizationRank")]),t._v(": 性价比排名")]),t._v(" "),s("li",[s("code",[t._v("ScientificResearch")]),t._v(": 科学研究得分")]),t._v(" "),s("li",[s("code",[t._v("ScientificResearchRank")]),t._v(": 科学研究排名")]),t._v(" "),s("li",[s("code",[t._v("PaperCitationWinner")]),t._v(": 论文引用胜者得分")]),t._v(" "),s("li",[s("code",[t._v("PaperCitationWinnerRank")]),t._v(": 论文引用胜者排名")]),t._v(" "),s("li",[s("code",[t._v("year")]),t._v(": 年份")]),t._v(" "),s("li",[s("code",[t._v("school_data_id")]),t._v(": 学校数据ID")]),t._v(" "),s("li",[s("code",[t._v("UndergraduateTraining")]),t._v(": 本科生培养得分")]),t._v(" "),s("li",[s("code",[t._v("UndergraduateTrainingRank")]),t._v(": 本科生培养排名")]),t._v(" "),s("li",[s("code",[t._v("PostgraduateTraining")]),t._v(": 研究生培养得分")]),t._v(" "),s("li",[s("code",[t._v("PostgraduateTrainingRank")]),t._v(": 研究生培养排名")]),t._v(" "),s("li",[s("code",[t._v("NaturalScienceResearch")]),t._v(": 自然科学研究得分")]),t._v(" "),s("li",[s("code",[t._v("NaturalScienceResearchRank")]),t._v(": 自然科学研究排名")]),t._v(" "),s("li",[s("code",[t._v("SocialScienceResearch")]),t._v(": 社会科学研究得分")]),t._v(" "),s("li",[s("code",[t._v("SocialScienceResearchRank")]),t._v(": 社会科学研究排名")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("competition_and_party_25 (竞赛与思政表)")]),t._v(" "),s("p",[s("strong",[t._v("说明")]),t._v("：包含本科、民办、职专的所有党建、思政、各种学生竞赛数据。为保证入库时结构统一，已按照"),s("code",[t._v("【1125定稿】竞赛名与赛道组别对照表.xlsx")]),t._v("重新梳理了所有竞赛的名称")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("long_id")]),t._v(": 唯一ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("category")]),t._v(": 竞赛类别")]),t._v(" "),s("li",[s("code",[t._v("competition_name")]),t._v(": 竞赛名称")]),t._v(" "),s("li",[s("code",[t._v("project_name")]),t._v(": 项目名称")]),t._v(" "),s("li",[s("code",[t._v("sub_project")]),t._v(": 竞赛具体信息")]),t._v(" "),s("li",[s("code",[t._v("competition_level")]),t._v(": 获奖等级")]),t._v(" "),s("li",[s("code",[t._v("sch_name")]),t._v(": 学校名称")]),t._v(" "),s("li",[s("code",[t._v("score")]),t._v(": 得分")]),t._v(" "),s("li",[s("code",[t._v("details")]),t._v(": 详细信息")]),t._v(" "),s("li",[s("code",[t._v("end_year")]),t._v(": 获奖时间")]),t._v(" "),s("li",[s("code",[t._v("sch_type")]),t._v(": 学校类型")])])]),t._v(" "),s("h3",{attrs:{id:"工单、新闻、咨询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工单、新闻、咨询"}},[t._v("#")]),t._v(" 工单、新闻、咨询")]),t._v(" "),s("h4",{attrs:{id:"表间联系-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表间联系-2"}},[t._v("#")]),t._v(" 表间联系")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ticket")]),t._v("和"),s("code",[t._v("ticket_followup")]),t._v("通过"),s("code",[t._v("ticket_id")]),t._v("关联，形成工单与追问的1对多关系")]),t._v(" "),s("li",[t._v("其他表之间没有直接外键关联，属于功能独立的模块")])]),t._v(" "),s("h4",{attrs:{id:"表结构说明-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表结构说明-5"}},[t._v("#")]),t._v(" 表结构说明")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("ticket_followup (工单追问表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("description")]),t._v(": 问题描述")]),t._v(" "),s("li",[s("code",[t._v("user_id")]),t._v(": 关联用户ID")]),t._v(" "),s("li",[s("code",[t._v("created_at")]),t._v(": 创建时间")]),t._v(" "),s("li",[s("code",[t._v("resolved_at")]),t._v(": 回复时间")]),t._v(" "),s("li",[s("code",[t._v("update_at")]),t._v(": 修改时间")]),t._v(" "),s("li",[s("code",[t._v("delete_at")]),t._v(": 删除时间")]),t._v(" "),s("li",[s("code",[t._v("status")]),t._v(": 状态(默认'待处理')")]),t._v(" "),s("li",[s("code",[t._v("resolution")]),t._v(": 回复内容")]),t._v(" "),s("li",[s("code",[t._v("ticket_id")]),t._v(": 关联工单ID")]),t._v(" "),s("li",[s("code",[t._v("attachment1")]),t._v(": 用户附件路径1")]),t._v(" "),s("li",[s("code",[t._v("attachment2")]),t._v(": 用户附件路径2")]),t._v(" "),s("li",[s("code",[t._v("admin_attachment1")]),t._v(": 客服附件1")]),t._v(" "),s("li",[s("code",[t._v("admin_attachment2")]),t._v(": 客服附件2")]),t._v(" "),s("li",[s("code",[t._v("ticketfollowup_id")]),t._v(": 追问工单ID(用于关联追问链)")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("ticket (工单主表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("module")]),t._v(": 问题模块")]),t._v(" "),s("li",[s("code",[t._v("description")]),t._v(": 问题描述")]),t._v(" "),s("li",[s("code",[t._v("status")]),t._v(": 工单状态(默认'pending')")]),t._v(" "),s("li",[s("code",[t._v("created_at")]),t._v(": 创建时间")]),t._v(" "),s("li",[s("code",[t._v("resolved_at")]),t._v(": 回复时间")]),t._v(" "),s("li",[s("code",[t._v("resolution")]),t._v(": 处理结果")]),t._v(" "),s("li",[s("code",[t._v("user_id")]),t._v(": 用户ID")]),t._v(" "),s("li",[s("code",[t._v("delete_at")]),t._v(": 删除时间")]),t._v(" "),s("li",[s("code",[t._v("title")]),t._v(": 工单标题")]),t._v(" "),s("li",[s("code",[t._v("kind")]),t._v(": 问题种类")]),t._v(" "),s("li",[s("code",[t._v("phone")]),t._v(": 联系电话")]),t._v(" "),s("li",[s("code",[t._v("is_read")]),t._v(": 是否已读")]),t._v(" "),s("li",[s("code",[t._v("follow_ups")]),t._v(": 废弃字段(原追问工单ID)")]),t._v(" "),s("li",[s("code",[t._v("ticket_id")]),t._v(": 工单编号")]),t._v(" "),s("li",[s("code",[t._v("update_at")]),t._v(": 修改时间")]),t._v(" "),s("li",[s("code",[t._v("attachment1")]),t._v(": 用户附件路径1")]),t._v(" "),s("li",[s("code",[t._v("attachment2")]),t._v(": 用户附件路径2")]),t._v(" "),s("li",[s("code",[t._v("admin_attachment1")]),t._v(": 客服附件1")]),t._v(" "),s("li",[s("code",[t._v("admin_attachment2")]),t._v(": 客服附件2")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("submit_application (咨询申请表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("id")]),t._v(": 自增ID(主键)")]),t._v(" "),s("li",[s("code",[t._v("institution")]),t._v(": 单位名称")]),t._v(" "),s("li",[s("code",[t._v("phone")]),t._v(": 联系电话")]),t._v(" "),s("li",[s("code",[t._v("email")]),t._v(": 电子邮箱")]),t._v(" "),s("li",[s("code",[t._v("name")]),t._v(": 联系人姓名")]),t._v(" "),s("li",[s("code",[t._v("message")]),t._v(": 咨询信息")]),t._v(" "),s("li",[s("code",[t._v("create_time")]),t._v(": 创建时间")]),t._v(" "),s("li",[s("code",[t._v("ip_address")]),t._v(": IP地址")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("information (新闻资讯表)")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("title")]),t._v(": 新闻标题")]),t._v(" "),s("li",[s("code",[t._v("id")]),t._v(": 记录ID")]),t._v(" "),s("li",[s("code",[t._v("url")]),t._v(": 新闻链接URL")])])]),t._v(" "),s("h2",{attrs:{id:"备份功能代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份功能代码"}},[t._v("#")]),t._v(" 备份功能代码")]),t._v(" "),s("p",[t._v("用于创建副表和触发器，及时记录（即局部备份）每项改动。")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("代码实现")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" contextlib "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" closing\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" re\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySQL 连接参数")]),t._v("\ndb_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'host'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.0.91'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wu'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'password'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xZ7FwtAD5HnhajxJ'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'database'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wurank'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'charset'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8mb4'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置字符集")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取表的列名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_columns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"SHOW COLUMNS FROM `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" column "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除历史表（如果存在）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("drop_history_table_if_exists")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    history_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_history"')])]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f\"SHOW TABLES LIKE '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"History table ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' already exists. Dropping it."')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"DROP TABLE IF EXISTS `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建历史表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_history_table")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    history_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_history"')])]),t._v("\n    columns_definition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"`')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("col"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('` VARCHAR(255)"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" col "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    history_table_sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"""\n    CREATE TABLE `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("` (\n        ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("columns_definition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(',\n        `change_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        `change_type` VARCHAR(10)\n    ) CHARACTER SET utf8mb4;\n    """')])]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_table_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"History table ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' created."')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除表上的所有触发器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete_triggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f\"SHOW TRIGGERS LIKE '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("';\"")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" trigger "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        trigger_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" trigger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Deleting trigger: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"DROP TRIGGER IF EXISTS `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`;"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建触发器 SQL")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_trigger_sql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    action "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INSERT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NEW'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UPDATE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NEW'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OLD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    action_fields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(".`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("col"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`'")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" col "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    history_columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"`')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("col"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" col "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'change_at'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'change_type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    action_values "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("action_fields"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(", NOW(), '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"""\n    CREATE TRIGGER `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lower"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\n    BEFORE ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" ON `")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\n    FOR EACH ROW\n    BEGIN\n        SET @trigger_status = (SELECT status FROM config_table WHERE config_item = '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("_trigger');\n        IF @trigger_status = 1 THEN\n            INSERT INTO `")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("` (")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(")\n            VALUES (")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("action_values"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(');\n        END IF;\n    END;\n    """')])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建所有触发器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_triggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    history_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_history"')])]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" trigger_type "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INSERT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UPDATE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        trigger_sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_trigger_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("trigger_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("update_triggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" closing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("db_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" closing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SET NAMES utf8mb4;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置会话字符集")]),t._v("\n            drop_history_table_if_exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            create_history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            delete_triggers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            create_triggers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"触发器和历史表更新成功: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 表的触发器和历史表已更新！"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"出现错误: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    table_names "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sch_report_data_gbbk_gzgz'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将表名作为参数传入")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" table_names"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        update_triggers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);