(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{302:function(t,s,a){t.exports=a.p+"assets/img/DBstructure.21b5aba1.jpg"},325:function(t,s,a){"use strict";a.r(s);var n=a(12),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"wurank数据库开发文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wurank数据库开发文档"}},[t._v("#")]),t._v(" wurank数据库开发文档")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("小贴士")]),t._v(" "),s("p",[t._v("目前已可局域网访问。暂时无法在公网访问。")])]),t._v(" "),s("h2",{attrs:{id:"结构介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结构介绍"}},[t._v("#")]),t._v(" 结构介绍")]),t._v(" "),s("p",[s("img",{attrs:{src:a(302),alt:"aa"}})]),t._v(" "),s("p",[t._v("这里将既有数据分为C、I、M、H、O五个区，赋予不同的功能。")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("C区")]),t._v("的字段数很精简，参与各种计算。例如，论文、专利、奖项、著作、学生竞赛、党建、艺术作品、就业质量报告数据、院校基本情况等数据需要月度频繁更新，每月大概要向C区更新50-100万条数据。"),s("Badge",{attrs:{text:"重要"}})],1)]),t._v(" "),s("li",[s("p",[s("code",[t._v("I区")]),t._v("和"),s("code",[t._v("C区")]),t._v("数据关联，仅用于向用户展示。例如，出于性能考虑，"),s("code",[t._v("C区")]),t._v("只存储论文的学科归属、得分信息，但不存储论文名称、期刊等具体信息。这些基本不参与计算的信息由"),s("code",[t._v("I区")]),t._v("存储，可向用户进行展示。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("H区")]),t._v("用于局部备份。对于每条数据的改动予以记录，允许版本回退。")])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("为表格添加局部备份功能代码（基于mysql的trigger实现）")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" contextlib "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" closing\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" re\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySQL 连接参数")]),t._v("\ndb_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'host'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.0.91'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wu'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'password'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xZ7FwtAD5HnhajxJ'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'database'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wurank'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'charset'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8mb4'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置字符集")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取表的列名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_columns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"SHOW COLUMNS FROM `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("column"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" column "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除历史表（如果存在）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("drop_history_table_if_exists")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    history_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_history"')])]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f\"SHOW TABLES LIKE '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"History table ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' already exists. Dropping it."')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"DROP TABLE IF EXISTS `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建历史表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_history_table")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    history_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_history"')])]),t._v("\n    columns_definition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"`')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("col"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('` VARCHAR(255)"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" col "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    history_table_sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"""\n    CREATE TABLE `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("` (\n        ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("columns_definition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(',\n        `change_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        `change_type` VARCHAR(10)\n    ) CHARACTER SET utf8mb4;\n    """')])]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history_table_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"History table ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' created."')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除表上的所有触发器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete_triggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f\"SHOW TRIGGERS LIKE '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("';\"")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" trigger "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        trigger_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" trigger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Deleting trigger: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"DROP TRIGGER IF EXISTS `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`;"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建触发器 SQL")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_trigger_sql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    action "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INSERT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NEW'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UPDATE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NEW'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OLD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    action_fields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(".`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("col"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`'")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" col "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    history_columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("', '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"`')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("col"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('`"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" col "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'change_at'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'change_type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    action_values "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("action_fields"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(", NOW(), '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"""\n    CREATE TRIGGER `')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lower"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\n    BEFORE ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" ON `")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\n    FOR EACH ROW\n    BEGIN\n        SET @trigger_status = (SELECT status FROM config_table WHERE config_item = '")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("_trigger');\n        IF @trigger_status = 1 THEN\n            INSERT INTO `")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("` (")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("history_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(")\n            VALUES (")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("action_values"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(');\n        END IF;\n    END;\n    """')])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建所有触发器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_triggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    columns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    history_table "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_history"')])]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" trigger_type "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INSERT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UPDATE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        trigger_sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_trigger_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" trigger_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("trigger_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("update_triggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" closing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("db_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" closing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SET NAMES utf8mb4;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置会话字符集")]),t._v("\n            drop_history_table_if_exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            create_history_table"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            delete_triggers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            create_triggers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cursor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"触发器和历史表更新成功: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 表的触发器和历史表已更新！"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"出现错误: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    table_names "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sch_report_data_gbbk_gzgz'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将表名作为参数传入")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" table_names"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        update_triggers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("M区")]),t._v("是初步计算后得到的数据，用于最终月度排名的计算，以及向用户进行展示。大部分数据预处理逻辑已完成。例如，对500万条论文数据进行计算，得到的按学校-学科分类加总分数，由M区存储，用于下一步计算。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("O区")]),t._v("用于部分交互行为。")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("long_id的编写说明")]),t._v(" "),s("p",[t._v("对于已有唯一号的，均予以保留。")]),t._v(" "),s("p",[t._v("未统一编号的，所使用的long_id形如B24111903002492。")]),t._v(" "),s("ul",[s("li",[t._v("第1位B（公办）本科/M民办本科/Z高职高专与职业大学，区分公办民办本科和职专（B有时会指公办民办本科，M不单列）。")]),t._v(" "),s("li",[t._v("2-7位填上传日期。")]),t._v(" "),s("li",[t._v("8-9位填上传时的领域，例如有10种不同竞赛，那么这两位可以依次填01-10，只要与本地文件保持一直即可。")]),t._v(" "),s("li",[t._v("10-15填递增序号。")])])]),t._v(" "),s("h2",{attrs:{id:"各表格-保质期-暂行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#各表格-保质期-暂行"}},[t._v("#")]),t._v(" 各表格“保质期”（暂行）")]),t._v(" "),s("ul",[s("li",[t._v("论文表：1年 ？ 不清楚未来是否完全废弃引用得分。")]),t._v(" "),s("li",[t._v("著作表（需单列）：3个月")]),t._v(" "),s("li",[t._v("专利表：1年")]),t._v(" "),s("li",[t._v("奖项表：永久（直接覆盖式更新）")]),t._v(" "),s("li",[t._v("学生竞赛和党建表：永久（直接覆盖式更新）")])]),t._v(" "),s("p",[t._v("过期后处理方法：整表替换，或保留最初一年的资料，其他年份数据全部替换。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("月度数据更新频次")]),t._v(" "),s("ol",[s("li",[t._v("国内SCD论文检索，已经是月更新的。一直在线服务的。")]),t._v(" "),s("li",[t._v("国际SCDW论文检索，还没上线，打算实现月更新（全库数据准备工作还没搞完，后续可以做到只给月度增量数据，Sqlite格式）")]),t._v(" "),s("li",[t._v("国内SCD图书检索，已经上线，打算实现季度更新（每次都是全库更新，去重动态计算，无法做到增量更新），全库1999-2024的MySQL数据已经交付")]),t._v(" "),s("li",[t._v("国内SCD专利检索，已经上线，打算实现月更新。（后续可以做到只给月度增量数据，Sqlite格式）")])])]),t._v(" "),s("h2",{attrs:{id:"c区表格介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c区表格介绍"}},[t._v("#")]),t._v(" C区表格介绍")]),t._v(" "),s("h3",{attrs:{id:"competition-and-party"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#competition-and-party"}},[t._v("#")]),t._v(" competition_and_party")]),t._v(" "),s("p",[t._v("包含本科、民办、职专的所有党建、思政、各种学生竞赛数据。\n为保证入库时结构统一，已按照"),s("code",[t._v("【1125定稿】竞赛名与赛道组别对照表.xlsx")]),t._v("重新梳理了所有竞赛的名称。今后入库时应按照最新名称入库。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("关联表格")]),t._v(" "),s("p",[t._v("此表与"),s("code",[t._v("competition_and_party_info")]),t._v(" 关联")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("字段说明")]),t._v(" "),s("p",[t._v("long_id : 见"),s("code",[t._v("结构介绍")])]),t._v(" "),s("p",[t._v("category : 根据对照表填写，可选党建、思政、创新创业、数学、数学研、田径、艺术、英语、计算机、职校大赛、艺术展演。其中数学研仅限本科，职校大赛仅限职专。")]),t._v(" "),s("p",[t._v("project_name : 根据对照表填写，第一级项目标题。")]),t._v(" "),s("p",[t._v("sub_project : 第二级项目标题。")]),t._v(" "),s("p",[t._v("sch name : 校名")]),t._v(" "),s("p",[t._v("score : 最终得分")]),t._v(" "),s("p",[t._v("end_year : 由于部分项目的年份信息为一个区间，所以这里取结束年份。")]),t._v(" "),s("p",[t._v("type : 根据陈艺滨的要求暂时保留。目前未使用。")])]),t._v(" "),s("h3",{attrs:{id:"enrollment-b"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enrollment-b"}},[t._v("#")]),t._v(" enrollment_b")]),t._v(" "),s("p",[t._v("公办、民办本科招生人数数据和本硕博人数折算分。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("此表仅用于计算本科专业排名，切勿用于计算科研得分。计算科研得分请使用"),s("code",[t._v("school_major_b")]),t._v("表")])]),t._v(" "),s("h3",{attrs:{id:"school-major-b"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#school-major-b"}},[t._v("#")]),t._v(" school_major_b")]),t._v(" "),s("p",[t._v("最终版招生专业情况。先经过了用各种数据对本科生招生数据进行增补调整，又经过了用研究生招生情况进行增补调整。适用于计算科研得分。")]),t._v(" "),s("h3",{attrs:{id:"enrollment-z"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enrollment-z"}},[t._v("#")]),t._v(" enrollment_z")]),t._v(" "),s("p",[t._v("增补调整后的职专招生人数和开设专业数据。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("此表可直接用于计算科研得分")])]),t._v(" "),s("h3",{attrs:{id:"research"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#research"}},[t._v("#")]),t._v(" research "),s("Badge",{attrs:{text:"体积大"}})],1),t._v(" "),s("p",[t._v("论文与专利数据。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("特别注意")]),t._v(" "),s("p",[t._v("计算本科科研得分时，须使用调整过的最终概率作为probability_all_in_one。此处应当跟子谦确认。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("关联表格")]),t._v(" "),s("p",[t._v("此表与"),s("code",[t._v("patent_info")]),t._v("和"),s("code",[t._v("paper_info")]),t._v("关联")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("字段说明")]),t._v(" "),s("p",[t._v("long_id : 论文对照号。")]),t._v(" "),s("p",[t._v("date : 日期")]),t._v(" "),s("p",[t._v("sch name : 校名")]),t._v(" "),s("p",[t._v("basic_score : 论文发表基础得分。据此还可以倒推出作者数量和作者顺序。")]),t._v(" "),s("p",[t._v("final_score : 论文最终得分。引用分=final_score - basic_score")]),t._v(" "),s("p",[t._v("probability_all_in_one：本科专业类概率。")]),t._v(" "),s("p",[t._v("from_db : SCD/SCDW/专利")]),t._v(" "),s("p",[t._v("type : 发明专利/实用新型/外观设计")]),t._v(" "),s("p",[t._v("sch_type : 本科/高职高专/民办独院")])]),t._v(" "),s("h3",{attrs:{id:"research-jiangxiang"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#research-jiangxiang"}},[t._v("#")]),t._v(" research_jiangxiang")]),t._v(" "),s("p",[t._v("奖项数据。由于奖项在月度更新时，会发生无法追溯和预测的增删改，因此单列。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("关联表格")]),t._v(" "),s("p",[t._v("此表与"),s("code",[t._v("jiangxiang_info")]),t._v("关联")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("字段说明")]),t._v(" "),s("p",[t._v("long_id : 由子谦、陈艺滨提供。")]),t._v(" "),s("p",[t._v("type : 国家知识产权局中国专利奖/省级教学成果奖/省级人文社科奖/教育部科学技术奖/教育部人文社科奖/国家级教学成果奖/国家级科学技术奖/省级科学技术奖")]),t._v(" "),s("p",[t._v("其他字段与"),s("code",[t._v("research")]),t._v("表相同")])]),t._v(" "),s("h3",{attrs:{id:"sch-basic-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sch-basic-data"}},[t._v("#")]),t._v(" sch_basic_data")]),t._v(" "),s("p",[t._v("本科、专科的院校基本信息。其中，"),s("code",[t._v("sch_id")]),t._v("字段和院校历史变迁有关。")]),t._v(" "),s("h3",{attrs:{id:"sch-manually-processed-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sch-manually-processed-data"}},[t._v("#")]),t._v(" sch_manually_processed_data")]),t._v(" "),s("p",[t._v("排名需要用到的、处理后的数据。这些数据比较独立，故单独做表存储之。目前包括论文引用胜者、国际论文引用胜者、国内论文引用胜者、标准薪酬、录取分数线。")]),t._v(" "),s("h3",{attrs:{id:"sch-report-data-gbbk-gzgz"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sch-report-data-gbbk-gzgz"}},[t._v("#")]),t._v(" sch_report_data_gbbk_gzgz")]),t._v(" "),s("p",[t._v("公办本科和高职高专的《就业质量报告》数据。由于公办和民办大学有的会重叠，所以这两份数据分开存储。对于早前的数据，date统一为发布年年底（如202312）")]),t._v(" "),s("h3",{attrs:{id:"sch-report-data-mbdy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sch-report-data-mbdy"}},[t._v("#")]),t._v(" sch_report_data_mbdy")]),t._v(" "),s("p",[t._v("民办独院的《就业质量报告》数据。")]),t._v(" "),s("h3",{attrs:{id:"school-major-b-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#school-major-b-2"}},[t._v("#")]),t._v(" school_major_b")]),t._v(" "),s("p",[t._v("最终用于计算科研得分的公办民办本科学校专业开设情况。")]),t._v(" "),s("h3",{attrs:{id:"school-major-z"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#school-major-z"}},[t._v("#")]),t._v(" school_major_z")]),t._v(" "),s("p",[t._v("最终用于计算科研得分的职专学校专业开设情况。")]),t._v(" "),s("h2",{attrs:{id:"h区表格介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#h区表格介绍"}},[t._v("#")]),t._v(" H区表格介绍")]),t._v(" "),s("p",[t._v("H区表格包含其他区表格的全部字段，只是多出change_at、change_type两个字段。change_at为更新时的时间戳，change_type为INSERT/UPDATE/DELETE。\n"),s("code",[t._v("research类")]),t._v("表格由于体积过大，一般不予备份。")]),t._v(" "),s("h2",{attrs:{id:"i区表格介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#i区表格介绍"}},[t._v("#")]),t._v(" I区表格介绍")]),t._v(" "),s("h3",{attrs:{id:"book-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#book-info"}},[t._v("#")]),t._v(" book_info")]),t._v(" "),s("p",[t._v("著作信息。存储"),s("code",[t._v("long_id")]),t._v("和"),s("code",[t._v("full_name")]),t._v("字段。")]),t._v(" "),s("h3",{attrs:{id:"competition-and-party-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#competition-and-party-info"}},[t._v("#")]),t._v(" competition_and_party_info")]),t._v(" "),s("p",[t._v("党建思政和学生竞赛信息。")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("字段说明")]),t._v(" "),s("p",[t._v("long_id : 编号，与C区表相匹配。")]),t._v(" "),s("p",[t._v("project_name：参考"),s("code",[t._v("【1125定稿】竞赛名与赛道组别对照表.xlsx")]),t._v("。")]),t._v(" "),s("p",[t._v("competition_level：获奖级别，如一等奖、（经费资助）20w、全国党建工作示范高校等等。")]),t._v(" "),s("p",[t._v("original_yr：所采集到的原始年份。有时为区间，如2020-2022。")]),t._v(" "),s("p",[t._v("details: 项目的名称、内容等。")]),t._v(" "),s("p",[t._v("original_org：部分职专院校的原始采集到的名称，根据陈艺滨的要求予以保留。")])]),t._v(" "),s("h3",{attrs:{id:"jiangxiang-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jiangxiang-info"}},[t._v("#")]),t._v(" jiangxiang_info")]),t._v(" "),s("p",[t._v("奖项信息。存储"),s("code",[t._v("long_id")]),t._v("、"),s("code",[t._v("项目名称")]),t._v("、"),s("code",[t._v("获奖等级")]),t._v("、"),s("code",[t._v("完成单位总数")]),t._v("、"),s("code",[t._v("完成单位顺序")]),t._v("字段。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("todo_待决策事项")]),t._v(" "),s("p",[t._v("原始采集到的奖项比实际用的奖项多出不少。二者的差主要是那些暂不参与排名的机构（如公司、研究所等）的数据。\n未来是否有可能用到这部分数据？是否需要将之存储在此表中？（也就是说，今后jiangxiang_info可能比C区表格条数更多，并且具有完整字段）。")]),t._v(" "),s("p",[t._v("暂时的处理方案是不予存储。")])]),t._v(" "),s("h3",{attrs:{id:"paper-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#paper-info"}},[t._v("#")]),t._v(" paper_info")]),t._v(" "),s("p",[t._v("论文信息。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("作者单位数与顺序")]),t._v(" "),s("p",[t._v("这里未记录作者单位数与顺序。可以根据C区表格的"),s("code",[t._v("basic_score")]),t._v("逆推。")])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("字段说明")]),t._v(" "),s("p",[t._v("long_id：论文对照号。")]),t._v(" "),s("p",[t._v("full_name：论文题目。")]),t._v(" "),s("p",[t._v("journal：期刊。")]),t._v(" "),s("p",[t._v("organAll：原始作者单位。")])]),t._v(" "),s("h3",{attrs:{id:"patent-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#patent-info"}},[t._v("#")]),t._v(" patent_info")]),t._v(" "),s("p",[t._v("专利信息。存储字段"),s("code",[t._v("long_id")]),t._v("、"),s("code",[t._v("full_name")]),t._v("、"),s("code",[t._v("unit_order")]),t._v("、"),s("code",[t._v("unit_number")])]),t._v(" "),s("h2",{attrs:{id:"m区表格介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#m区表格介绍"}},[t._v("#")]),t._v(" M区表格介绍")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("建设中...")]),t._v(" "),s("p",[t._v("M区表格正在建设中，请以最新建设情况为准。")])]),t._v(" "),s("p",[t._v("应当包含3张表，分别用以存储按照专业类、专业门类、研究生学科类等计算得到的科研得分。")]),t._v(" "),s("p",[t._v("应当包含1张表，用以存储党建竞赛的得分。")]),t._v(" "),s("p",[t._v("应当包含1张表，用以分院校-学科存储科研细项（发明专利、英文他引得分等等）。")]),t._v(" "),s("p",[t._v("应当包含1张表，用以存储各项原始数据本次排名计算周期、本周期（如本月）、上周期三个阶段的原始数据数量（增量）。")]),t._v(" "),s("h2",{attrs:{id:"o区表格介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#o区表格介绍"}},[t._v("#")]),t._v(" O区表格介绍")]),t._v(" "),s("h3",{attrs:{id:"config-table"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#config-table"}},[t._v("#")]),t._v(" config_table")]),t._v(" "),s("p",[t._v("决定局部备份是否开启")]),t._v(" "),s("h3",{attrs:{id:"readme"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#readme"}},[t._v("#")]),t._v(" _readme_")]),t._v(" "),s("p",[t._v("决定在数据库管理器上所显示的表格别名。")]),t._v(" "),s("h3",{attrs:{id:"table-update-time"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#table-update-time"}},[t._v("#")]),t._v(" table_update_time")]),t._v(" "),s("p",[t._v("记录各表格的最后更新时间。一般由trigger自动生成。")])])}),[],!1,null,null,null);s.default=r.exports}}]);